% Rapport

% TOADD:

Ce pilote est capable de gérer jusqu'à 15 capteurs connectés à la 
machine via un réseau de type CAN. Chacun dispose d'un identifiant
unique, codé sur 8 bits, et envoie un message composé de cet
identifiant ainsi que de 4 octets de données, exploitable par
l'application (ex. température).
Le driver se charge de dater l'arrivée de chaque message.
La datation est relative au driver, et n'a qu'un usage
de chronologie de réception des messages.
Il est possible d'accéder, par une lecture destructrice, aux
10 dernières valeurs envoyées par le capteur.

Il est possible, de façon transparante, de réassocier un descripteur
de fichier ouvert avec un nouveau capteur, si le précédent est 
par exemple défaillant.

\textsl{
Note:\\
On adopte le préfixe PIC (pour PIlote de Capteur).
}

\section{Spécification des fonctions d'interface}

\subsection{Fonctions publiques}

\begin{m_desc}

 \item [PIC\_DrvInstall] \hfill\\
installe le driver.
Le temps est réinitialisé, ainsi que la numérotation des messages.
Retourne 0 en cas de succès, -1 sinon.

 \item [PIC\_DrvRemove] \hfill\\
désinstalle le driver.
Les capteurs doivent être supprimés.
Retourne 0 en cas de succès, -1 sinon.

 \item [PIC\_DevAdd] \hfill\\
 prend comme paramètres le nom du capteur et son identifiant associé (le choix de 
ces deux paramètres est laissé à l'utilisateur). Elle vérifie que aucun autre 
capteur n'utilise le même identifiant et/ou le même nom et ajoute le capteur
 si ces conditions sont vérifiées.
Le périphérique n'est ajouté que si le nombre de capteur utilisé après ajout
 est inférieur ou égal à 15.

Le nom et l'adresse des capteurs doivent être uniques.

Retourne le nombre de capteurs en cas de succès, -1 sinon.
ERRNO est placé à PIC\_E\_TOOMANYDEV si il y a trop de capteurs enregistrés.

 \item [PIC\_DevDelete] \hfill\\
supprime le périphérique demandé si il existe. 
Retourne 0 en cas de succès, -1 sinon.


\item [PIC\_ioctl]\hfill\\
permet de contôler le driver.
Il est possible de réassocier un descripteur de fichier avec un capteur ouvert
en fournissant le descripteur de fichier et l'adresse du nouveau capteur.

Retourne 0 en cas de réussite, -1 en cas d'échec, avec ERRNO placé à 
PIC\_E\_PARAM\_INCORRECTS.
\end{m_desc}


\section{Plan de test}

On se propose de pratiquer les tests suivants sur notre pilote de périphérique dans les situations suivantes :

\begin{enumerate}
 \item utilisation normale:
        installation du driver, ajout de plusieurs capteurs, lectures, 
changement à chaud avec ioctl, retrait capteurs, désinstallation du driver.
 \item ajout de plus de quinze capteurs:
On récipère -1 en retour et ERRNO est placé à PIC\_E\_TOOMANYDEV.
 \item ouverture du même périphérique plus d'une fois:
On récupère -1 en code retour.
\end{enumerate}
